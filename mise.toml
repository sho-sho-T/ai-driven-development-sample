[tools]
bun = "latest"
node = "22"
"aqua:supabase/cli" = "latest"
gh = "latest"
rust = "latest"

[env]
_.file = ".env"

[tasks.dev]
description = "Start all dev servers (web:3000, admin-web:3001, dev-console:3002)"
run = """
bunx concurrently \
  -n web,console \
  -c blue,yellow \
  "cd apps/web && bun run dev" \
  "cd apps/dev-console && bun run dev"
"""

[tasks."dev:web"]
description = "Start web dev server"
run = "cd apps/web && bun run dev"

[tasks."dev:admin"]
description = "Start admin-web dev server"
run = "cd apps/admin-web && bun run dev"

[tasks."dev:console"]
description = "Start dev-console dev server"
run = "cd apps/dev-console && bun run dev"

[tasks.lint]
description = "Run lint checks with Biome"
run = "bun run lint"

[tasks.format]
description = "Format code with Biome"
run = "bun run format"

[tasks.db]
description = "Start Supabase services"
run = "supabase --workdir packages/platform/supabase start"

[tasks."db:stop"]
description = "Stop Supabase services"
run = "supabase --workdir packages/platform/supabase stop"

[tasks."db:reset"]
description = "Reset database (re-apply migrations)"
run = "supabase --workdir packages/platform/supabase db reset"

[tasks."db:push"]
description = "Push migrations to Supabase Cloud"
run = "supabase --workdir packages/platform/supabase db push"

[tasks."deploy:prod"]
description = "Deploy Supabase migrations and TanStack Start app to Cloudflare Workers"
run = """
echo "[1/3] Pushing database migrations to Supabase Cloud..."
supabase --workdir packages/platform/supabase db push
echo "[2/3] Building TanStack Start app..."
cd apps/web && bun run build
echo "[3/3] Deploying to Cloudflare Workers..."
bunx wrangler deploy
echo "Deploy complete."
"""
