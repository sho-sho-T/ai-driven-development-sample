# 図書貸出管理アプリケーション 要件定義書

## 1. 概要

図書館における書籍の管理と貸出業務を支援するWebアプリケーション。
DDD・CQRS・モジュラーモノリスの学習を目的としたサンプルアプリケーションである。

---

## 2. ユーザーと役割

| 役割 | 説明 |
|---|---|
| **図書館員（Librarian）** | 書籍の登録・管理、貸出・返却の処理を行う |
| **利用者（Member）** | 書籍の検索・閲覧、貸出状況の確認を行う |

---

## 3. Bounded Context

本アプリケーションは以下の3つの Bounded Context で構成する。

| Context | 責務 |
|---|---|
| **catalog** | 書籍情報の管理（登録・更新・検索） |
| **lending** | 貸出・返却・予約の管理 |
| **member** | 利用者情報の管理（登録・更新） |

---

## 4. 機能要件

### 4.1 書籍管理（catalog）

| ID | 機能 | 説明 |
|---|---|---|
| CAT-1 | 書籍登録 | ISBN、タイトル、著者、出版社、出版年を指定して書籍を登録する |
| CAT-2 | 書籍情報更新 | 登録済み書籍の情報を更新する |
| CAT-3 | 書籍検索 | タイトル・著者・ISBNで書籍を検索する |
| CAT-4 | 書籍一覧表示 | 登録済み書籍の一覧を表示する |
| CAT-5 | 書籍詳細表示 | 書籍の詳細情報と貸出可否状態を表示する |

### 4.2 貸出管理（lending）

| ID | 機能 | 説明 |
|---|---|---|
| LEN-1 | 貸出処理 | 利用者に書籍を貸し出す。貸出期間は14日間 |
| LEN-2 | 返却処理 | 貸出中の書籍を返却する |
| LEN-3 | 貸出延長 | 貸出期間を7日間延長する（1回のみ） |
| LEN-4 | 貸出履歴表示 | 利用者ごとの貸出履歴を表示する |
| LEN-5 | 延滞チェック | 返却期限を超過した貸出を検出する |

### 4.3 利用者管理（member）

| ID | 機能 | 説明 |
|---|---|---|
| MEM-1 | 利用者登録 | 名前、メールアドレスを指定して利用者を登録する |
| MEM-2 | 利用者情報更新 | 登録済み利用者の情報を更新する |
| MEM-3 | 利用者検索 | 名前・メールアドレスで利用者を検索する |
| MEM-4 | 利用者詳細表示 | 利用者の詳細情報と現在の貸出状況を表示する |

---

## 5. ビジネスルール

### 5.1 貸出ルール

- 1人の利用者が同時に借りられる書籍は **最大5冊**
- 貸出期間は **14日間**
- 延長は **1回のみ**、**7日間**
- 延滞中の利用者は新規貸出不可
- 同一書籍の重複貸出は不可（既に借りている書籍を再度借りることはできない）

### 5.2 書籍ルール

- ISBN は一意でなければならない
- タイトルと著者は必須
- 書籍が貸出中の場合は削除不可

### 5.3 利用者ルール

- メールアドレスは一意でなければならない
- 名前は必須
- 貸出中の書籍がある利用者は削除不可

---

## 6. Context 間の連携

### 6.1 イベントフロー

```
[catalog] BookRegistered  →  lending が貸出可能な書籍として認識
[member] MemberRegistered →  lending が貸出可能な利用者として認識
[lending] BookBorrowed    →  catalog が書籍の貸出状態を更新
[lending] BookReturned    →  catalog が書籍の貸出状態を更新
```

### 6.2 Context 間の依存方向

```
lending → catalog (書籍IDで参照)
lending → member  (利用者IDで参照)
catalog ← lending (イベント経由で状態同期)
```

---

## 7. 非機能要件

| 項目 | 内容 |
|---|---|
| 認証・認可 | スコープ外（将来対応） |
| データベース | Supabase (PostgreSQL) |
| フロントエンド | TanStack Start |
| テスト | Write 側の Domain Model / Application にユニットテスト必須 |
| エラーハンドリング | Result 型による例外レス設計 |

---

## 8. 画面一覧（参考）

| 画面 | パス | 説明 |
|---|---|---|
| 書籍一覧 | `/books` | 書籍の一覧表示・検索 |
| 書籍詳細 | `/books/:id` | 書籍の詳細情報・貸出状態 |
| 書籍登録 | `/books/new` | 新規書籍の登録フォーム |
| 利用者一覧 | `/members` | 利用者の一覧表示・検索 |
| 利用者詳細 | `/members/:id` | 利用者の詳細・貸出状況 |
| 利用者登録 | `/members/new` | 新規利用者の登録フォーム |
| 貸出処理 | `/lending/checkout` | 書籍の貸出処理 |
| 返却処理 | `/lending/return` | 書籍の返却処理 |
| 貸出履歴 | `/lending/history` | 貸出履歴の一覧 |
